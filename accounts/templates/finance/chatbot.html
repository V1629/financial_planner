<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Financial Assistant - RAG Chatbot</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
      background: white;
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      animation: fadeInUp 0.6s ease;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 3s ease-in-out infinite;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.95;
      position: relative;
      z-index: 1;
    }

    .chat-container {
      padding: 40px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 20px 40px;
      background: #f8f9fa;
      border-top: 1px solid #e9ecef;
    }

    .btn {
      background: white;
      color: #667eea;
      padding: 12px 30px;
      border: 2px solid #667eea;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
      transform: translateY(-2px);
      box-shadow: 0 5px 25px rgba(102, 126, 234, 0.4);
    }

    .chat-history {
      margin-bottom: 30px;
      max-height: 400px;
      overflow-y: auto;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
    }

    .message {
      margin-bottom: 20px;
      animation: slideIn 0.3s ease;
    }

    .message-user {
      text-align: right;
    }

    .message-bubble {
      display: inline-block;
      max-width: 75%;
      padding: 15px 20px;
      border-radius: 18px;
      word-wrap: break-word;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .message-user .message-bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message-bot .message-bubble {
      background: white;
      color: #333;
      border: 2px solid #e9ecef;
      border-bottom-left-radius: 4px;
    }

    .message-label {
      font-size: 0.85em;
      color: #999;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .message-user .message-label {
      text-align: right;
    }

    .form-container {
      position: relative;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .input-wrapper {
      position: relative;
    }

    textarea {
      width: 100%;
      padding: 20px;
      border: 2px solid #e9ecef;
      border-radius: 15px;
      font-size: 1em;
      font-family: inherit;
      resize: vertical;
      min-height: 120px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    textarea::placeholder {
      color: #adb5bd;
    }

    .char-count {
      position: absolute;
      bottom: 10px;
      right: 15px;
      font-size: 0.85em;
      color: #999;
      background: white;
      padding: 2px 8px;
      border-radius: 5px;
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    button[type="submit"] {
      flex: 1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
    }

    button[type="submit"]:active {
      transform: translateY(0);
    }

    button[type="submit"]:disabled {
      background: #adb5bd;
      cursor: not-allowed;
      transform: none;
    }

    .clear-btn {
      padding: 15px 30px;
      background: white;
      color: #dc3545;
      border: 2px solid #dc3545;
      border-radius: 12px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .clear-btn:hover {
      background: #dc3545;
      color: white;
    }

    .response-box {
      margin-top: 30px;
      padding: 25px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-left: 5px solid #667eea;
      border-radius: 15px;
      animation: slideIn 0.5s ease;
    }

    .response-box h3 {
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3em;
    }

    .response-box p {
      color: #555;
      line-height: 1.8;
      font-size: 1.05em;
      white-space: pre-wrap;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading.active {
      display: block;
    }

    .loading-dots {
      display: inline-flex;
      gap: 8px;
    }

    .loading-dots span {
      width: 12px;
      height: 12px;
      background: #667eea;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .loading-dots span:nth-child(1) {
      animation-delay: -0.32s;
    }

    .loading-dots span:nth-child(2) {
      animation-delay: -0.16s;
    }

    .suggestions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .suggestion-btn {
      padding: 15px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-size: 0.95em;
      color: #555;
    }

    .suggestion-btn:hover {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .suggestion-icon {
      font-size: 1.5em;
      margin-bottom: 8px;
      display: block;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state svg {
      width: 100px;
      height: 100px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .empty-state h3 {
      color: #666;
      margin-bottom: 10px;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: translate(0, 0);
      }
      50% {
        transform: translate(10%, 10%);
      }
    }

    @keyframes bounce {
      0%, 80%, 100% {
        transform: scale(0);
      }
      40% {
        transform: scale(1);
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      .chat-container {
        padding: 20px;
      }

      .message-bubble {
        max-width: 85%;
      }

      .suggestions {
        grid-template-columns: 1fr;
      }

      .button-group {
        flex-direction: column;
      }

      .nav-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>
        <span>ü§ñ</span>
        AI Financial Assistant
      </h1>
      <p>Ask me anything about your finances and spending patterns</p>
    </div>

    <div class="chat-container">
      <!-- Suggested Questions -->
      {% if not response %}
      <div class="suggestions">
        <div class="suggestion-btn" onclick="fillQuery('What is my total spending this month?')">
          <span class="suggestion-icon">üí∞</span>
          <strong>Total Spending</strong>
          <p style="font-size: 0.85em; margin-top: 5px; color: #999;">Check monthly expenses</p>
        </div>
        <div class="suggestion-btn" onclick="fillQuery('Which category do I spend most on?')">
          <span class="suggestion-icon">üìä</span>
          <strong>Top Category</strong>
          <p style="font-size: 0.85em; margin-top: 5px; color: #999;">Identify spending patterns</p>
        </div>
        <div class="suggestion-btn" onclick="fillQuery('Give me tips to save money')">
          <span class="suggestion-icon">üí°</span>
          <strong>Saving Tips</strong>
          <p style="font-size: 0.85em; margin-top: 5px; color: #999;">Get financial advice</p>
        </div>
        <div class="suggestion-btn" onclick="fillQuery('Analyze my recent transactions')">
          <span class="suggestion-icon">üîç</span>
          <strong>Transaction Analysis</strong>
          <p style="font-size: 0.85em; margin-top: 5px; color: #999;">Review recent activity</p>
        </div>
      </div>
      {% endif %}

      <!-- Response Box -->
      {% if response %}
      <div class="response-box">
        <h3>
          <span>ü§ñ</span>
          AI Assistant Response
        </h3>
        <p>{{ response }}</p>
      </div>
      {% endif %}

      <!-- Loading Indicator -->
      <div class="loading" id="loadingIndicator">
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <p style="margin-top: 15px; color: #667eea; font-weight: 600;">Analyzing your data...</p>
      </div>

      <!-- Chat Form -->
      <div class="form-container">
        <form method="POST" id="chatForm" onsubmit="showLoading()">
          {% csrf_token %}
          <div class="input-wrapper">
            <textarea 
              name="query" 
              id="queryInput"
              rows="3" 
              placeholder="Ask your question... (e.g., 'How much did I spend on food last month?')"
              maxlength="500"
              oninput="updateCharCount()"
              required
            ></textarea>
            <span class="char-count" id="charCount">0/500</span>
          </div>
          
          <div class="button-group">
            <button type="submit" id="submitBtn">
              <span>‚ú®</span>
              Ask AI Assistant
            </button>
            {% if response %}
            <button type="button" class="clear-btn" onclick="window.location.href='{% url 'chatbot' %}'">
              üîÑ New Question
            </button>
            {% endif %}
          </div>
        </form>
      </div>
    </div>

    <div class="nav-buttons">
      <a href="{% url 'home' %}" class="btn">
        <span>‚Üê</span> Back to Home
      </a>
      <a href="{% url 'visualize' %}" class="btn">
        <span>üìä</span> View Analytics
      </a>
    </div>
  </div>

  <script>
    // Fill query from suggestion
    function fillQuery(text) {
      document.getElementById('queryInput').value = text;
      updateCharCount();
      document.getElementById('queryInput').focus();
    }

    // Update character count
    function updateCharCount() {
      const input = document.getElementById('queryInput');
      const count = document.getElementById('charCount');
      const length = input.value.length;
      count.textContent = `${length}/500`;
      
      if (length > 450) {
        count.style.color = '#dc3545';
      } else if (length > 400) {
        count.style.color = '#ffc107';
      } else {
        count.style.color = '#999';
      }
    }

    // Show loading indicator
    function showLoading() {
      document.getElementById('loadingIndicator').classList.add('active');
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('submitBtn').innerHTML = '<span>‚è≥</span> Processing...';
    }

    // Auto-resize textarea
    const textarea = document.getElementById('queryInput');
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = (this.scrollHeight) + 'px';
    });

    // Focus on input when page loads
    window.addEventListener('load', function() {
      document.getElementById('queryInput').focus();
    });

    // Handle Enter key (Shift+Enter for new line, Enter to submit)
    textarea.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        document.getElementById('chatForm').submit();
      }
    });

    // Initialize character count
    updateCharCount();
  </script>
</body>
</html>
